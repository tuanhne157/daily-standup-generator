<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>📝 Daily Standup Report</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css" />
</head>
<body>

  <div class="container my-4">
    <% if (typeof success !== 'undefined' && success == 1) { %>
      <div class="alert alert-success text-center">
        ✅ Report generated and saved successfully!
      </div>
    <% } %>

    <h1 class="text-primary text-center mb-4">📝 Daily Standup Report</h1>

    <!-- ✅ Yesterday -->
    <div class="card p-3 mb-4">
      <h4 class="text-success mb-3">✅ Yesterday</h4>
      <ul class="list-group">
        <% if (commits.length) { %>
          <% commits.forEach(c => { %>
            <li class="list-group-item"><%= c %></li>
          <% }) %>
        <% } else { %>
          <li class="list-group-item text-muted fst-italic">No commits</li>
        <% } %>
      </ul>
    </div>

    <!-- 📋 Today -->
    <div class="card p-3 mb-4">
      <h4 class="text-info mb-3">📋 Today</h4>
      <ul class="list-group">
        <% if (issues.length) { %>
          <% issues.forEach(i => { %>
            <li class="list-group-item">
              <strong><%= i.title || i %></strong>
              <% if (i.description) { %>
                <div class="text-muted small"><%= i.description %></div>
              <% } %>
              <% if (i.link) { %>
                <div><a href="<%= i.link %>" target="_blank"><%= i.link %></a></div>
              <% } %>
            </li>
          <% }) %>
        <% } else { %>
          <li class="list-group-item text-muted fst-italic">No issues</li>
        <% } %>
      </ul>
    </div>

    <!-- 🚧 Blockers -->
    <div class="card p-3 mb-4">
      <form action="/generate" method="POST">
        <h3>🚧 Blockers</h3>
        <div class="form-group">
          <label for="blocker-select">Chọn lý do blocker (nếu có):</label>
          <select name="blocker" id="blocker-select" class="form-control">
            <option value="">-- Không có blocker --</option>
            <option value="Chờ phản hồi từ khách hàng">Chờ phản hồi từ khách hàng</option>
            <option value="Chưa có API từ team backend">Chưa có API từ team backend</option>
            <option value="Đợi thiết kế từ designer">Đợi thiết kế từ designer</option>
            <option value="Không truy cập được môi trường staging">Không truy cập được môi trường staging</option>
            <option value="Khác">Khác</option>
          </select>
        </div>

        <div class="text-center my-5">
          <button type="submit" class="btn btn-primary btn-lg">
            📤 Generate & Save Report
          </button>
        </div>
      </form>
    </div>

    <!-- 🕓 Report History -->
    <h2 class="text-secondary mt-5 mb-3">🕓 Report History</h2>
    <% if (!history.length) { %>
      <div class="alert alert-light text-muted">Chưa có báo cáo nào trước đó.</div>
    <% } else { %>
      <% history.forEach(report => { %>
        <div class="card p-4 mb-4 shadow-sm">
          <h5 class="mb-3 text-dark"><%= report.date %></h5>

          <h6 class="text-success mb-2">✅ Yesterday</h6>
          <ul class="list-group mb-3">
            <% if (report.commits.length) { %>
              <% report.commits.forEach(c => { %>
                <li class="list-group-item"><%= c %></li>
              <% }) %>
            <% } else { %>
              <li class="list-group-item text-muted fst-italic">No commits</li>
            <% } %>
          </ul>

          <h6 class="text-info mb-2">📋 Today</h6>
          <ul class="list-group mb-3">
            <% if (report.issues.length) { %>
              <% report.issues.forEach(i => { %>
                <li class="list-group-item">
                  <strong><%= i.title || i %></strong>
                  <% if (i.description) { %>
                    <div class="text-muted small"><%= i.description %></div>
                  <% } %>
                  <% if (i.link) { %>
                    <div><a href="<%= i.link %>" target="_blank"><%= i.link %></a></div>
                  <% } %>
                </li>
              <% }) %>
            <% } else { %>
              <li class="list-group-item text-muted fst-italic">No issues</li>
            <% } %>
          </ul>

          <h6 class="text-warning mb-2">🚧 Blockers</h6>
          <p class="mb-0">
            <% if (report.blockers && report.blockers.length) { %>
              <%= report.blockers.join(', ') %>
            <% } else { %>
              - None
            <% } %>
          </p>
        </div>
      <% }) %>
    <% } %>
  </div>

  <form action="/reset" method="POST" class="text-center my-3">
    <button type="submit" class="btn btn-danger">
      🗑️ Reset All Reports
    </button>
  </form>

</body>
</html>
